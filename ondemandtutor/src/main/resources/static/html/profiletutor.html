<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../js/openHF.js"></script>
    <link rel="stylesheet" href="../assets/css/footer.css">
    <link rel="stylesheet" href="../assets/css/header.css">
    <link rel="stylesheet" href="../assets/css/profile.css">
    <link rel="stylesheet" href="../assets/fonts/fontawesome-free-6.5.2-web/css/all.min.css">
    <title>Document</title>
</head>

<body>
<div class="main">
    <header class="header">
        <!--test-->
        <div class="logo-container">
            <a class="img-logo" href="../html/home.html">
                <!-- <img class="logo" src="../assets/img/logo/snapedit_17228353747082.png" alt=""> -->
                <p class="text">LEARN TOgetHER</p>  </a>
        </div>

        <div class="navbar-container">

            <a class="nav-box" href="../html/gioithieu.html">GIỚI THIỆU</a>

            <a class="nav-box" href="./tutor.html">GIA SƯ

            </a>


            <a class="nav-box" href="./dichvulist.html">DỊCH VỤ

            </a>
            <a class="nav-box hidden" href="./taodichvu.html">TẠO DỊCH VỤ

            </a>
        </div>
        <div class="login-search-container">
            <div class="message-container" id="messageContainer">
                <a href="messages.html" class="message-link">
                    <i class="message-icon fa-regular fa-message"></i>
                    <span class="message-count" id="messageCount">0</span>
                </a>
            </div>

            <div class="login-container">
                <a href="modal.html" class="search-link">
                    <button id="loginButton" class="login-button">Đăng nhập</button>
                </a>
                <div class="user-info" id="userInfo">
                    <span id="usernameDisplay"></span>
                    <img id="avatar" src="https://th.bing.com/th/id/OIP.MaDrjtmPQGzKiLHrHEPfFAHaHa?w=199&h=199&c=7&r=0&o=5&pid=1.7" alt="Avatar" class="avatar">

                    <div id="userDropdown" class="user-dropdown">
                        <a href="editprofile.html" class="sub-menu-link">
                            <img src="../assets/img/header/profile.png" alt="">
                            <p>Thông tin cá nhân</p>
                            <i class="fa-solid fa-chevron-right"></i>
                        </a>
                        <a href="#" id="logoutButton" class="sub-menu-link">
                            <img src="../assets/img/header/logout.png" alt="">
                            <p>Đăng xuất</p>
                            <i class="fa-solid fa-chevron-right"></i>
                        </a>

                    </div>
                </div>
            </div>
        </div>

    </header>
    <div class="container">
        <div class="navigation">
            <ul>
                <li>
                    <a href="profiletutor.html">
                            <span class="icon">
                                <i class="fa-regular fa-user"></i>
                            </span>
                        <span class="title-strong">Thông tin cá nhân</span>
                    </a>
                </li>

                <li>
                    <a class="border" href="editprofiletutor.html">
                            <span class="icon">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </span>
                        <span class="title ">Chỉnh sửa trang cá nhân</span>
                    </a>
                </li>

                <li>
                    <a href="edit_schedule.html">
                            <span class="icon">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </span>
                        <span class="title">Chỉnh sửa dịch vụ</span>
                    </a>
                </li>

                <li>
                    <a href="#">
                            <span class="icon">
                                <i class="fa-solid fa-lock"></i>
                            </span>
                        <span class="title">Mật khẩu</span>
                    </a>
                </li>
            </ul>
        </div>
        <div class="profile-container">
            <div class="profile-pic-container" id="profilePicContainer">
                <img id="profilePic" src="https://th.bing.com/th/id/OIP.MaDrjtmPQGzKiLHrHEPfFAHaHa?w=199&h=199&c=7&r=0&o=5&pid=1.7" alt="Profile Picture" class="profile-pic">
            </div>
            <div class="input-fields">
                <div class="input-group">
                    <label for="role">Chức vụ</label>
                    <span id="role">Giáo viên</span>
                </div>
                <div class="input-group">
                    <label for="name">Họ và tên</label>
                    <span id="name">Nguyễn Văn A</span>
                </div>
                <div class="input-group">
                    <label for="email">Email</label>
                    <span id="email">nguyenvana@example.com</span>
                </div>
                <div class="input-group">
                    <label for="subjectId">Khóa học</label>
                    <span id="subjectId">Chưa cập nhật</span>
                </div>
                <div class="input-group">
                    <label for="address">Tỉnh/Thành phố</label>
                    <span id="address">Chưa cập nhật</span>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <link rel="stylesheet" href="../assets/css/footer.css">
        <link rel="stylesheet" href="../assets/fonts/fontawesome-free-6.5.2-web/css/all.min.css">
        <div class="footer-container">
            <div class="socials">
                <a href=""><i class="fa-brands fa-facebook"></i></a>
                <a href=""><i class="fa-brands fa-instagram"></i></a>
                <a href=""><i class="fa-brands fa-twitter"></i></a>
                <a href=""><i class="fa-brands fa-google-plus"></i></a>
                <a href=""><i class="fa-brands fa-youtube"></i></a>
            </div>
            <div class="footer-nav">
                <ul>
                    <li><a href="">Home</a></li>
                    <li><a href="">About</a></li>
                    <li><a href="">Contact Us</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Copyright &copy;2024; Designed by <span class="designer">DL</span></p>
        </div>
    </footer>
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <div class="wrap">
                <span class="close-button">&times;</span>
                <h2>Đổi mật khẩu</h2>
                <div class="input-group input-modal">
                    <label for="currentPassword">Mật khẩu hiện tại</label>
                    <input type="password" id="currentPassword" name="currentPassword">
                </div>
                <div class="input-group input-modal">
                    <label for="newPassword">Mật khẩu mới</label>
                    <input type="password" id="newPassword" name="newPassword">
                </div>
                <div class="input-group input-modal">
                    <label for="confirmPassword">Nhập lại mật khẩu mới</label>
                    <input type="password" id="confirmPassword" name="confirmPassword">
                </div>
                <button type="submit" id="changePasswordButton" class="submit-button">Đổi mật khẩu</button>
            </div>
        </div>
    </div>
</div>
<script src="../js/header.js"></script>
<script>



    async function getMyInfo() {
        try {
            const token = localStorage.getItem('token');

                const response = await fetch('http://localhost:8080/v1/tutor/myInfo', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                    // Thêm Authorization header nếu cần thiết
                }
            });

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const data = await response.json();
            // Cập nhật thông tin cá nhân lên giao diện
            document.getElementById('role').innerText = data.result.role;
            document.getElementById('name').innerText = data.result.name;
            document.getElementById('email').innerText = data.result.email;
            const avatarElement = document.getElementById('avatar');
            const profilePicElement = document.getElementById('profilePic');

            if (data.result.imgUrl) { // Kiểm tra nếu có URL của hình đại diện
                avatarElement.src = data.result.imgUrl;
                profilePicElement.src=data.result.imgUrl;
            } else {
                avatarElement.src = 'https://th.bing.com/th/id/OIP.MaDrjtmPQGzKiLHrHEPfFAHaHa?w=199&h=199&c=7&r=0&o=5&pid=1.7'; // Hình đại diện mặc định
                profilePicElement.src= 'https://th.bing.com/th/id/OIP.MaDrjtmPQGzKiLHrHEPfFAHaHa?w=199&h=199&c=7&r=0&o=5&pid=1.7';
            }
            if (!data.result.subjectId == "" ) {
                document.getElementById('subjectId').innerText = data.result.subjectId;
            }
            if (!data.result.address == "")
            {
                document.getElementById('address').innerText = data.result.address;
            }


        } catch (error) {
            console.error('There was a problem with the fetch operation:', error);
        }
    }

    // Gọi hàm getMyInfo khi trang được tải
    window.onload = getMyInfo;
</script>
<script>
    var modal = document.getElementById("passwordModal");

    var passwordLink = document.querySelector('.navigation li:nth-child(4) a');

    var closeButton = document.getElementsByClassName("close-button")[0];

    passwordLink.onclick = function () {
        modal.style.display = "block";
    }

    closeButton.onclick = function () {
        modal.style.display = "none";
    }

    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

</script>
<script>
    document.getElementById('changePasswordButton').addEventListener('click', function(event) {
        event.preventDefault(); // Ngăn chặn hành động mặc định của nút submit

        // Lấy giá trị từ các input fields
        const currentPassword = document.getElementById('currentPassword').value.trim();
        const newPassword = document.getElementById('newPassword').value.trim();
        const confirmPassword = document.getElementById('confirmPassword').value.trim();

        // Kiểm tra tính hợp lệ của dữ liệu
        if (!currentPassword || !newPassword || !confirmPassword) {
            alert('Vui lòng điền đầy đủ thông tin.');
            return;
        }

        if (newPassword !== confirmPassword) {
            alert('Mật khẩu mới và xác nhận mật khẩu không khớp.');
            return;
        }

        // Tạo đối tượng request payload
        const userUpdateRequest = {
            oldPass: currentPassword,
            password: newPassword,
        };

        // Lấy Bearer token từ localStorage
        const token = localStorage.getItem('token');

        // Gọi API PUT để cập nhật thông tin người dùng
        fetch('http://localhost:8080/v1/users', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(userUpdateRequest)
        })
            .then(response => response.json())
            .then(data => {
                if (data.code === 1000) {
                    alert('Thông tin người dùng đã được cập nhật thành công!');
                    window.location.reload();
                } else {
                    alert(`Có lỗi xảy ra khi cập nhật thông tin người dùng: ${data.message || 'Lỗi không xác định'}`);
                }
            })
            .catch(error => {
                console.error('Error updating user info:', error);
                alert('Có lỗi xảy ra khi kết nối tới máy chủ.');
            });
    });

</script>
</body>

</html>
